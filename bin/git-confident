#!/usr/bin/env ruby

require 'rubygems' if RUBY_VERSION < '1.9'
require 'optparse'
ROOT_PATH = File.dirname( File.expand_path( File.dirname( __FILE__ ) ) )
LIB_PATH  = File.join( ROOT_PATH, 'lib' )
$:.unshift( LIB_PATH )
require 'git/confident'

options = {
  :path   => File.expand_path( Dir::pwd ) # Default to current directory
}

def usage
  puts @opts.to_s
  exit 0
end

@opts = OptionParser.new do | opts |
  opts.banner = "Usage: #{ $0 } [options]"

  opts.on("-b", "--backup", "Copy tracked files to the repository, commit changes and push") do
    options[ :action ] = :backup
  end

  opts.on("-C", "--no-commit", "Only copy files, do not do a git commit") do
    options[ :action ] = :backup
    options[ :no_commit ] = true
  end

  opts.on("-l", "--list", "List all files in the repository") do
    options[ :action ] = :list
  end

  opts.on("-r", "--restore", "Restore system files from the repository") do
    options[ :action ] = :restore
  end

  opts.on("-h", "--help", "Show usage") do
    usage
  end

  opts.on("-p", "--path PATH", "The path to the local copy of the repository. Defaults to current directory") do | path |
    options[ :path ] = File.expand_path( path )
  end
end

@opts.parse!

usage if options[ :action ].nil?

Git::Confident.new( options )
